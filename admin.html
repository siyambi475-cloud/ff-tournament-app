<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER ADMIN CONTROL - DHAKA E-SPORTS</title>
    <style>
        :root { --main: #ff4b2b; --bg: #0b0c10; --card: #1a1b21; }
        body { background: var(--bg); color: white; font-family: ' Rajdhani', sans-serif; padding: 20px; }
        .card { background: var(--card); padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
        input, select { padding: 10px; margin: 5px; background: #000; color: white; border: 1px solid #444; border-radius: 5px; }
        button { padding: 10px 15px; background: var(--main); border: none; color: white; font-weight: bold; border-radius: 5px; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { border: 1px solid #333; padding: 10px; text-align: left; }
        th { background: #222; }
    </style>
</head>
<body>

    <h2>MASTER ADMIN CONTROL</h2>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="card">
            <h3>‚öôÔ∏è APP SETTINGS</h3>
            <input type="text" id="admin-number" placeholder="Bkash/Nagad Number">
            <button onclick="updateNum()">UPDATE NUMBER</button>
        </div>
        <div class="card">
            <h3>üñºÔ∏è SLIDER (Image URL)</h3>
            <input type="text" id="slide-url" placeholder="Paste Link">
            <button onclick="addSlide()">ADD SLIDE</button>
        </div>
    </div>

    <div class="card">
        <h3>‚ûï CREATE MATCH</h3>
        <input type="text" id="m-title" placeholder="Match Title">
        <select id="m-mode"><option value="BR">Battle Royale</option><option value="CS">Clash Squad</option></select>
        <input type="text" id="m-map" placeholder="Map Name">
        <input type="number" id="m-fee" placeholder="Entry Fee">
        <input type="number" id="m-prize" placeholder="Prize Pool">
        <button onclick="saveMatch()" style="background: #2ecc71;">POST MATCH</button>
    </div>

    <div class="card">
        <h3>üí∞ PENDING PAYMENTS</h3>
        <table id="pay-table">
            <thead><tr><th>Type</th><th>Amt</th><th>Trx/Num</th><th>Action</th></tr></thead>
            <tbody id="pay-body"></tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase Configuration (DO NOT CHANGE)
        const firebaseConfig = {
            apiKey: "AIzaSyD7G-O9kFFMSBOf1m23gtPKZ677q67xyEY",
            authDomain: "ffrnvm.firebaseapp.com",
            projectId: "ffrnvm",
            storageBucket: "ffrnvm.firebasestorage.app",
            messagingSenderId: "578541384954",
            appId: "1:578541384954:web:a7c20373284014b3244543"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ‡ßß. ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.saveMatch = async () => {
            try {
                const title = document.getElementById('m-title').value;
                const mode = document.getElementById('m-mode').value;
                const map = document.getElementById('m-map').value;
                const fee = Number(document.getElementById('m-fee').value);
                const prize = Number(document.getElementById('m-prize').value);

                if(!title || !map || !fee) return alert("Please fill all fields!");

                await addDoc(collection(db, "matches"), {
                    title, mode, map, fee, prize, status: "UPCOMING", roomId: "", roomPass: ""
                });
                alert("Success! Match added to Firebase.");
                location.reload(); // ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
            } catch (e) {
                console.error(e);
                alert("Error: " + e.message);
            }
        };

        // ‡ß®. ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        onSnapshot(collection(db, "payments"), (snap) => {
            const body = document.getElementById('pay-body');
            body.innerHTML = "";
            snap.forEach(d => {
                const p = d.data();
                body.innerHTML += `<tr>
                    <td>${p.type}</td><td>${p.amount}</td><td>${p.trxid || p.number}</td>
                    <td>
                        <button onclick="approve('${d.id}', '${p.uid}', ${p.amount}, '${p.type}')" style="background:green">Approve</button>
                        <button onclick="deleteData('payments', '${d.id}')" style="background:red">Reject</button>
                    </td>
                </tr>`;
            });
        });

        // ‡ß©. ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶æ‡¶≤ ‡¶≤‡¶ú‡¶ø‡¶ï
        window.approve = async (id, uid, amt, type) => {
            try {
                if(type === 'DEPOSIT') {
                    const userRef = doc(db, "users", uid);
                    const userSnap = await getDoc(userRef);
                    if(userSnap.exists()){
                        await updateDoc(userRef, { balance: (userSnap.data().balance || 0) + amt });
                    } else {
                        alert("User not found in Database!");
                    }
                }
                await deleteDoc(doc(db, "payments", id));
                alert("Request Approved Successfully!");
            } catch (e) { alert("Error: " + e.message); }
        };

        window.deleteData = async (col, id) => {
            if(confirm("Are you sure?")) await deleteDoc(doc(db, col, id));
        };
    </script>
</body>
</html>
