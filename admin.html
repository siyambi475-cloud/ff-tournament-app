<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DHAKA E-SPORTS - MASTER ADMIN</title>
    <style>
        body { background: #0b0c10; color: white; font-family: sans-serif; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: #1a1b21; padding: 20px; border-radius: 10px; border: 1px solid #333; margin-bottom: 20px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; background: #0b0c10; border: 1px solid #444; color: white; }
        button { padding: 10px; background: #ff4b2b; border: none; color: white; cursor: pointer; border-radius: 5px; font-weight: bold; width: 100%; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border-bottom: 1px solid #333; padding: 10px; text-align: left; }
    </style>
</head>
<body>
    <h1 style="color:#ff4b2b; text-align:center;">ADMIN MASTER PANEL</h1>
    <div class="grid">
        <div class="card">
            <h3>Add Match</h3>
            <input type="text" id="title" placeholder="Title"><input type="text" id="map" placeholder="Map">
            <input type="number" id="fee" placeholder="Fee"><input type="number" id="prize" placeholder="Prize">
            <select id="status"><option value="UPCOMING">Upcoming</option><option value="ONGOING">Ongoing</option><option value="RESULT">Result</option></select>
            <button id="addMatchBtn">POST MATCH</button>
        </div>
        <div class="card">
            <h3>Send Notification</h3>
            <input type="text" id="noti-msg" placeholder="Notification Message">
            <button id="sendNotiBtn">UPDATE APP NOTICE</button>
        </div>
    </div>
    <div class="card">
        <h3>Pending Payments</h3>
        <table>
            <thead><tr><th>UID</th><th>Amount</th><th>TrxID</th><th>Action</th></tr></thead>
            <tbody id="payment-requests"></tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD7G-O9kFFMSBOf1m23gtPKZ677q67xyEY",
            authDomain: "ffrnvm.firebaseapp.com",
            projectId: "ffrnvm",
            storageBucket: "ffrnvm.firebasestorage.app",
            messagingSenderId: "578541384954",
            appId: "1:578541384954:web:a7c20373284014b3244543"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.getElementById('addMatchBtn').onclick = async () => {
            const title = document.getElementById('title').value;
            const map = document.getElementById('map').value;
            const fee = document.getElementById('fee').value;
            const prize = document.getElementById('prize').value;
            const status = document.getElementById('status').value;
            await addDoc(collection(db, "matches"), { title, map, fee, prize, status });
            alert("Match Added!");
        };

        document.getElementById('sendNotiBtn').onclick = async () => {
            const msg = document.getElementById('noti-msg').value;
            await addDoc(collection(db, "notifications"), { message: msg, active: true });
            alert("Notice Updated!");
        };

        onSnapshot(collection(db, "payments"), (snap) => {
            const list = document.getElementById('payment-requests');
            list.innerHTML = "";
            snap.forEach(d => {
                const p = d.data();
                if(p.status === "PENDING") {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${p.uid.substring(0,5)}</td><td>${p.amount}</td><td>${p.trxid}</td>
                        <td><button style="background:#2ecc71" onclick="approvePayment('${d.id}', '${p.uid}', ${p.amount})">Approve</button></td>`;
                    list.appendChild(tr);
                }
            });
        });

        window.approvePayment = async (id, uid, amt) => {
            await updateDoc(doc(db, "users", uid), { balance: increment(parseInt(amt)) });
            await deleteDoc(doc(db, "payments", id));
            alert("Approved!");
        };
    </script>
</body>
</html>
