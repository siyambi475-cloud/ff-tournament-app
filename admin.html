<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MASTER ADMIN - FULL CONTROL</title>
    <style>
        body { background: #0b0c10; color: white; font-family: sans-serif; padding: 20px; }
        .card { background: #1a1b21; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #333; padding: 10px; text-align: left; }
        input, select { padding: 10px; margin: 5px; background: #000; color: white; border: 1px solid #444; }
        button { padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; background: #ff4b2b; color: white; font-weight: bold; }
        .btn-green { background: #2ecc71; }
    </style>
</head>
<body>
    <h1>MASTER ADMIN CONTROL</h1>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="card">
            <h3>‚öôÔ∏è APP SETTINGS</h3>
            <input type="text" id="admin-number" placeholder="Bikas/Nagad Number">
            <button onclick="updateNum()">UPDATE NUMBER</button>
        </div>
        <div class="card">
            <h3>üñºÔ∏è SLIDER (Image URL)</h3>
            <input type="text" id="slide-url" placeholder="Paste Link">
            <button onclick="addSlide()">ADD SLIDE</button>
        </div>
    </div>

    <div class="card">
        <h3>‚ûï CREATE MATCH</h3>
        <input type="text" id="m-title" placeholder="Title">
        <select id="m-mode"><option value="BR">BR</option><option value="CS">CS</option><option value="LW">LW</option></select>
        <input type="text" id="m-map" placeholder="Map">
        <input type="number" id="m-fee" placeholder="Fee">
        <input type="number" id="m-prize" placeholder="Prize">
        <button onclick="saveMatch()">POST MATCH</button>
    </div>

    <div class="card">
        <h3>üìã PLAYER JOIN LIST</h3>
        <select id="sel-match" onchange="loadPlayers()"><option>Select Match</option></select>
        <table id="p-table">
            <thead><tr><th>Name</th><th>UID</th><th>Action</th></tr></thead>
            <tbody id="p-body"></tbody>
        </table>
    </div>

    <div class="card">
        <h3>üí∞ PENDING PAYMENTS</h3>
        <table id="pay-table"></table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc, deleteDoc, getDoc, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD7G-O9kFFMSBOf1m23gtPKZ677q67xyEY",
            authDomain: "ffrnvm.firebaseapp.com",
            projectId: "ffrnvm",
            storageBucket: "ffrnvm.firebasestorage.app",
            messagingSenderId: "578541384954",
            appId: "1:578541384954:web:a7c20373284014b3244543"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ‡ßß. ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ì ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞
        window.updateNum = async () => {
            const num = document.getElementById('admin-number').value;
            await updateDoc(doc(db, "settings", "app"), { number: num });
            alert("Updated!");
        };
        window.addSlide = async () => {
            const url = document.getElementById('slide-url').value;
            await addDoc(collection(db, "slider"), { url });
            alert("Slide Added!");
        };

        // ‡ß®. ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶§‡ßà‡¶∞‡¶ø
        window.saveMatch = async () => {
            const title = document.getElementById('m-title').value;
            const mode = document.getElementById('m-mode').value;
            const map = document.getElementById('m-map').value;
            const fee = Number(document.getElementById('m-fee').value);
            const prize = Number(document.getElementById('m-prize').value);
            await addDoc(collection(db, "matches"), { title, mode, map, fee, prize, status: "UPCOMING" });
            alert("Match Posted!");
        };

        // ‡ß©. ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶°
        onSnapshot(collection(db, "matches"), (snap) => {
            const sel = document.getElementById('sel-match');
            sel.innerHTML = "<option>Select Match</option>";
            snap.forEach(d => sel.innerHTML += `<option value="${d.id}">${d.data().title}</option>`);
        });

        window.loadPlayers = () => {
            const mid = document.getElementById('sel-match').value;
            onSnapshot(collection(db, "match_joiners"), (snap) => {
                const body = document.getElementById('p-body');
                body.innerHTML = "";
                snap.forEach(d => {
                    if(d.data().matchId === mid) {
                        body.innerHTML += `<tr><td>${d.data().playerName}</td><td>${d.data().uid}</td>
                        <td><button onclick="deleteDoc(doc(db, 'match_joiners', '${d.id}'))">Kick</button></td></tr>`;
                    }
                });
            });
        };

        // ‡ß™. ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤
        onSnapshot(collection(db, "payments"), (snap) => {
            const table = document.getElementById('pay-table');
            table.innerHTML = "<tr><th>Type</th><th>Amt</th><th>Details</th><th>Action</th></tr>";
            snap.forEach(d => {
                const p = d.data();
                table.innerHTML += `<tr><td>${p.type}</td><td>${p.amount}</td><td>${p.trxid || p.number}</td>
                <td><button class="btn-green" onclick="approve('${d.id}', '${p.uid}', ${p.amount}, '${p.type}')">Approve</button>
                <button onclick="deleteDoc(doc(db, 'payments', '${d.id}'))">Reject</button></td></tr>`;
            });
        });

        window.approve = async (id, uid, amt, type) => {
            if(type === 'DEPOSIT') {
                const userRef = doc(db, "users", uid);
                const userSnap = await getDoc(userRef);
                await updateDoc(userRef, { balance: (userSnap.data().balance || 0) + amt });
            }
            await deleteDoc(doc(db, "payments", id));
            alert("Approved!");
        };
    </script>
</body>
</html>
